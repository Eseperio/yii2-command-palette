var CommandPalette=function(){"use strict";function b(i,e){if(!i||!e)return 1/0;let t=1/0;for(let s=0;s<=e.length-i.length;s++){const n=e.substr(s,i.length);t=Math.min(t,x(i,n))}return t=Math.min(t,x(i,e)),t}function x(i,e){const t=i.length,s=e.length;if(t===0)return s;if(s===0)return t;const n=[];for(let r=0;r<=t;r++)n[r]=[r];for(let r=1;r<=s;r++)n[0][r]=r;for(let r=1;r<=t;r++)for(let l=1;l<=s;l++){const c=i[r-1].toLowerCase()===e[l-1].toLowerCase()?0:1;n[r][l]=Math.min(n[r-1][l]+1,n[r][l-1]+1,n[r-1][l-1]+c)}return n[t][s]}function v(i,e){if(!i)return e.slice();i=i.trim().toLowerCase();let t=e.filter(s=>{const n=s.name.toLowerCase(),r=s.subtitle?s.subtitle.toLowerCase():"";return n.includes(i)||r.includes(i)});return t.length>0?t:e.map(s=>{const n=s.name.toLowerCase(),r=s.subtitle?s.subtitle.toLowerCase():"",l=b(i,n),c=r?b(i,r):1/0,h=Math.min(l,c),d=n.includes(i)||r.includes(i);return{...s,_score:h,_substringMatch:d}}).sort((s,n)=>s._substringMatch&&!n._substringMatch?-1:!s._substringMatch&&n._substringMatch?1:s._score-n._score).filter(s=>s._substringMatch||s._score<=2)}const S={en:{search:"Search...",noResults:"No results"},es:{search:"Buscar...",noResults:"Sin resultados"},fr:{search:"Rechercher...",noResults:"Aucun r√©sultat"},de:{search:"Suchen...",noResults:"Keine Ergebnisse"},it:{search:"Cerca...",noResults:"Nessun risultato"},pt:{search:"Pesquisar...",noResults:"Sem resultados"},ru:{search:"–ü–æ–∏—Å–∫...",noResults:"–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"},zh:{search:"ÊêúÁ¥¢...",noResults:"Ê≤°ÊúâÁªìÊûú"},ja:{search:"Ê§úÁ¥¢...",noResults:"ÁµêÊûú„Å™„Åó"},ar:{search:"ÿ®ÿ≠ÿ´...",noResults:"ŸÑÿß ŸÜÿ™ÿßÿ¶ÿ¨"}};function I(i,e="en"){return S[e]||(e="en"),S[e][i]||i}function R(i){if(typeof i!="string")return null;const e=i.toLowerCase();if(e.startsWith("mailto:"))return{type:"email",color:"#f59e0b"};if(e.startsWith("tel:"))return{type:"phone",color:"#10b981"};if(e.startsWith("http://"))return{type:"unsecure",color:"#ef4444"};const t=e.match(/^(ftp|ftps|sms|spotify|steam|slack|discord|zoom|teams|whatsapp):/);return t?{type:t[1],color:"#3b82f6"}:null}function u(i,e,t=0,s="en"){const n=i.getAttribute("data-selected-idx"),r=i.querySelectorAll(".cmdk-item").length;if(i.children.length>0&&e.length>0&&e.length===r&&n!==null){const a=i.querySelector(`.cmdk-item[data-idx="${n}"]`),m=i.querySelector(`.cmdk-item[data-idx="${t}"]`);if(a&&a.classList.remove("selected"),m){m.classList.add("selected"),i.setAttribute("data-selected-idx",t);return}}if(i.innerHTML="",e.length===0){const a=I("noResults",s);i.innerHTML=`<li style="padding: 16px; color: #8b8b93;">${a}</li>`;return}const l=i.id.replace("cmdkList-",""),c=document.getElementById(`cmdkItemTemplate-${l}`);if(!c){console.error(`Template element not found: cmdkItemTemplate-${l}`);return}const h=c.innerHTML,d=document.createDocumentFragment();e.forEach((a,m)=>{if(a._isSeparator){const p=document.createElement("li");p.className="cmdk-separator",p.innerHTML='<hr style="border: none; border-top: 1px solid #e5e5e5; margin: 8px 0;">',d.appendChild(p);return}let o=h;o=o.replace(/{{idx}}/g,m);const f=R(a.action);let g=a.name||"";if(f&&(g=`<span style="display: inline-block; padding: 2px 6px; margin-right: 6px; font-size: 10px; font-weight: bold; color: white; background-color: ${f.color}; border-radius: 3px; text-transform: uppercase;">${f.type}</span>`+g),o=o.replace(/{{name}}/g,g),a.icon){const p=i.id.replace("cmdkList-",""),D=window[`cmdkAllowHtmlIcons_${p}`]||!1;typeof a.icon=="string"&&a.icon.match(/^https?:\/\//)?o=o.replace(/{{#icon}}([\s\S]*?){{\/icon}}/g,`<img src="${a.icon}" class="cmdk-icon" style="width: 22px; height: 22px; object-fit: cover;">`):D?o=o.replace(/{{#icon}}([\s\S]*?){{\/icon}}/g,a.icon):(o=o.replace(/{{icon}}/g,a.icon),o=o.replace(/{{#icon}}([\s\S]*?){{\/icon}}/g,"$1"))}else o=o.replace(/{{#icon}}[\s\S]*?{{\/icon}}/g,"");a.subtitle?(o=o.replace(/{{subtitle}}/g,a.subtitle),o=o.replace(/{{#subtitle}}([\s\S]*?){{\/subtitle}}/g,"$1")):o=o.replace(/{{#subtitle}}[\s\S]*?{{\/subtitle}}/g,"");const E=document.createElement("div");E.innerHTML=o;const y=E.firstElementChild;a._isLoading&&y.classList.add("_loading"),a._isError&&y.classList.add("_error"),a._isSearchSuggestion&&y.classList.add("_search-suggestion"),m===t&&y.classList.add("selected"),d.appendChild(y)}),i.appendChild(d),i.setAttribute("data-selected-idx",t)}function w(i){const e=i.querySelector(".cmdk-item.selected");e&&e.scrollIntoView({block:"nearest"})}function C(i,e=!1){i&&(typeof i.action=="function"?i.action():typeof i.action=="string"&&(/^#/.test(i.action)?window.location.hash=i.action:e?window.open(i.action,"_blank"):window.location.href=i.action))}function T(i,e){const{overlay:t,panel:s,search:n,list:r}=i,{onSearch:l,onKeyDown:c,onItemClick:h,onOverlayClick:d,onPanelBlur:a,onFocusIn:m}=e;n&&l&&n.addEventListener("input",l),n&&c&&n.addEventListener("keydown",c),r&&h&&r.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();const f=o.target.closest(".cmdk-item");if(f){const g=parseInt(f.getAttribute("data-idx"),10);h(g)}}),r&&r.addEventListener("mousemove",o=>{const f=o.target.closest(".cmdk-item");if(f){const g=parseInt(f.getAttribute("data-idx"),10);e.onItemHover&&e.onItemHover(g)}}),t&&d&&t.addEventListener("click",d),s&&a&&s.addEventListener("blur",a,!0),m&&document.addEventListener("focusin",m),e.onGlobalKeyDown&&window.addEventListener("keydown",e.onGlobalKeyDown)}class L{constructor(e=!1,t="[CommandPalette]"){this.debug=e,this.prefix=t,this.debug&&console.log("%c"+this.prefix+" Debug mode is ENABLED","color: red; font-weight: bold;")}log(...e){this.debug&&console.log(this.prefix,...e)}warn(...e){this.debug&&console.warn(this.prefix,...e)}error(...e){this.debug&&console.error(this.prefix,...e)}info(...e){this.debug&&console.info(this.prefix,...e)}}function M(i=[],e=[],t=null){const s=[],n=new Set;let r=0;return i.forEach(c=>{typeof c.action=="string"&&n.add(c.action)}),document.querySelectorAll("a[href]").forEach(c=>{if($(c,e)){t&&t.log("Link skipped (in excluded element):",c.href),r++;return}const h=c.href;if(n.has(h)){t&&t.log("Link skipped (duplicate):",h),r++;return}let d=_(c);if(!d){t&&t.log("Link skipped (no text):",h),r++;return}const a=A(c),m={icon:"üîó",name:d.trim(),subtitle:a||h,action:h};s.push(m),n.add(h)}),t&&t.log("Links scraper found",s.length,"links","(skipped",r,")"),s}function _(i){let e=i.textContent.trim();return!e&&i.hasAttribute("title")&&(e=i.getAttribute("title").trim()),!e&&i.hasAttribute("aria-label")&&(e=i.getAttribute("aria-label").trim()),e||null}function A(i){let e=i.parentElement;for(;e&&e!==document.body;){const t=e.querySelectorAll("h1, h2, h3, h4, h5, h6");for(const s of t)if(e.contains(s)&&e.contains(i)&&!i.contains(s)&&s!==i){const n=s.textContent.trim();if(n)return n}e=e.parentElement}return null}function $(i,e){if(!e||e.length===0)return!1;for(const t of e)try{if(i.matches(t)||i.closest(t))return!0}catch(s){console.error("Invalid exclude selector:",t,s)}return!1}class P{constructor(e,t=!1){this.endpoint=e.endpoint,this.types=e.types||[],this.minChars=e.minChars||3,this.timeout=e.timeout||300,this.logger=new L(t),this.currentRequest=null,this.debounceTimer=null,this.isLoading=!1,this.activeType=null,this.lastError=null,this.logger.log("External search initialized with config:",e)}matchType(e){if(!this.types||this.types.length===0)return null;const t=e.trim().toLowerCase().split(/\s+/);for(const s of t)for(const n of this.types){const r=n.toLowerCase();if(s===r)return{type:n,matchedWord:s,distance:0};const l=x(s,r),c=Math.ceil(r.length*.3);if(l<=c)return{type:n,matchedWord:s,distance:l}}return null}extractSearchTerms(e,t){return e.split(/\s+/).filter(s=>s.toLowerCase()!==t.toLowerCase()).join(" ").trim()}async search(e,t=null){if(this.currentRequest&&(this.currentRequest.abort(),this.logger.log("Previous search request cancelled")),e.length<this.minChars)return this.logger.log("Query too short, minimum:",this.minChars),[];this.isLoading=!0,this.lastError=null;try{const s=new AbortController;this.currentRequest=s;const n=new URL(this.endpoint,window.location.origin);n.searchParams.append("query",e),t&&n.searchParams.append("type",t),this.logger.log("Fetching external results from:",n.toString());const r=await fetch(n.toString(),{method:"GET",headers:{Accept:"application/json"},signal:s.signal});if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);const l=await r.json();return this.logger.log("External search results:",l.length,"items"),Array.isArray(l)?l:[]}catch(s){if(s.name==="AbortError")return this.logger.log("Search request aborted"),[];throw this.logger.error("External search error:",s),this.lastError=s.message,s}finally{this.isLoading=!1,this.currentRequest=null}}debouncedSearch(e,t,s){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(async()=>{try{const n=await this.search(e,t);s(n,null)}catch(n){s([],n)}},this.timeout)}cancel(){this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),this.currentRequest&&(this.currentRequest.abort(),this.currentRequest=null),this.isLoading=!1}}class k{constructor(e,t=[],s={}){this.id=e;const{locale:n="en",debug:r=!1,enableLinksScraper:l=!1,linkScraperExcludeSelectors:c=[],maxRecentItems:h=0,externalSearch:d=null}=s;if(this.enableLinksScraper=l,this.linkScraperExcludeSelectors=c,this.logger=new L(r),this.enableLinksScraper){const a=M(t,this.linkScraperExcludeSelectors,this.logger);this.items=[...t,...a]}else this.items=t;this.filtered=[...this.items],this.selectedIdx=0,this.isOpen=!1,this.locale=n,this.debug=r,this.maxRecentItems=h,this.ctrlKeyPressed=!1,this.externalSearch=d?new P(d,r):null,this.externalResults=[],this.searchMode=null,this.logger.log("Initializing command palette with",this.items.length,"items"),this.logger.log("Recent items:",h>0?`enabled (max: ${h})`:"disabled"),this.externalSearch&&this.logger.log("External search enabled for types:",d.types),this.elements={overlay:document.getElementById(`cmdkOverlay-${e}`),panel:document.getElementById(`cmdkPanel-${e}`),searchContainer:document.getElementById(`cmdkSearchContainer-${e}`),search:document.getElementById(`cmdkSearch-${e}`),list:document.getElementById(`cmdkList-${e}`)},this.elements.search&&(this.elements.search.placeholder=I("search",this.locale)),this.init()}init(){T(this.elements,{onSearch:this.handleSearch.bind(this),onKeyDown:this.handleKeyDown.bind(this),onItemClick:this.selectItem.bind(this),onItemHover:this.handleItemHover.bind(this),onOverlayClick:this.close.bind(this),onPanelBlur:this.handlePanelBlur.bind(this),onFocusIn:this.handleFocusIn.bind(this),onGlobalKeyDown:this.handleGlobalKeyDown.bind(this)}),document.addEventListener("keydown",e=>{(e.key==="Control"||e.key==="Meta")&&(this.ctrlKeyPressed=!0,this.logger.log("Ctrl/Cmd key pressed"))}),document.addEventListener("keyup",e=>{(e.key==="Control"||e.key==="Meta")&&(this.ctrlKeyPressed=!1,this.logger.log("Ctrl/Cmd key released"))}),u(this.elements.list,this.filtered,this.selectedIdx,this.locale)}getRecentItemsKey(){return`cmdPalette_recentItems_${this.id}`}getRecentItems(){if(this.maxRecentItems===0)return[];try{const e=localStorage.getItem(this.getRecentItemsKey());if(!e)return[];const t=JSON.parse(e);return this.logger.log("Retrieved",t.length,"recent items from localStorage"),Array.isArray(t)?t:[]}catch(e){return this.logger.error("Error loading recent items from localStorage:",e),[]}}addRecentItem(e){if(this.maxRecentItems!==0)try{let t=this.getRecentItems();t=t.filter(s=>!(s.name===e.name&&s.action===e.action)),t.unshift(e),t.length>this.maxRecentItems&&(t=t.slice(0,this.maxRecentItems)),localStorage.setItem(this.getRecentItemsKey(),JSON.stringify(t)),this.logger.log("Added item to recent items:",e.name)}catch(t){this.logger.error("Error saving recent item to localStorage:",t)}}mergeItemsWithRecent(e,t){if(e.length===0)return t;const s=t.filter(r=>!e.some(l=>l.name===r.name&&l.action===r.action));if(s.length===0)return e;const n={_isSeparator:!0,name:"",action:null};return[...e,n,...s]}open(){if(this.isOpen)return;this.logger.log("Opening command palette"),this.isOpen=!0,this.elements.overlay.style.display="block",this.elements.panel.style.display="flex",setTimeout(()=>this.elements.search.focus(),20),this.elements.search.value="";const e=this.getRecentItems();for(this.filtered=this.mergeItemsWithRecent(e,this.items),this.selectedIdx=0;this.filtered[this.selectedIdx]&&this.filtered[this.selectedIdx]._isSeparator;)this.selectedIdx++;u(this.elements.list,this.filtered,this.selectedIdx,this.locale)}close(){this.logger.log("Closing command palette"),this.isOpen=!1,this.elements.overlay.style.display="none",this.elements.panel.style.display="none",this.searchMode&&this.exitSearchMode()}handleSearch(e){const t=e.target.value.trim();if(this.searchMode){this.performExternalSearch(t);return}if(t){const s=this.getRecentItems(),n=this.mergeItemsWithRecent(s,this.items);if(this.filtered=v(t,n.filter(r=>!r._isSeparator)),this.externalSearch&&t){const r=this.externalSearch.matchType(t);if(r){const l=this.externalSearch.extractSearchTerms(t,r.matchedWord),c={icon:"üîç",name:`Search "${l||"..."}" in ${r.type}`,subtitle:"Press Enter to search in this category",action:null,_isSearchSuggestion:!0,_searchType:r.type,_searchTerms:l};this.filtered=[c,...this.filtered]}}}else{const s=this.getRecentItems();this.filtered=this.mergeItemsWithRecent(s,this.items)}for(this.selectedIdx=0;this.filtered[this.selectedIdx]&&this.filtered[this.selectedIdx]._isSeparator;)this.selectedIdx++;u(this.elements.list,this.filtered,this.selectedIdx,this.locale)}handleKeyDown(e){if(e.key==="Backspace"&&this.searchMode&&this.elements.search.value===""){e.preventDefault(),this.exitSearchMode();return}if(e.key==="ArrowDown"){e.preventDefault();let t=(this.selectedIdx+1)%this.filtered.length;for(;this.filtered[t]&&this.filtered[t]._isSeparator;)t=(t+1)%this.filtered.length;this.selectedIdx=t,u(this.elements.list,this.filtered,this.selectedIdx,this.locale),w(this.elements.list)}else if(e.key==="ArrowUp"){e.preventDefault();let t=(this.selectedIdx-1+this.filtered.length)%this.filtered.length;for(;this.filtered[t]&&this.filtered[t]._isSeparator;)t=(t-1+this.filtered.length)%this.filtered.length;this.selectedIdx=t,u(this.elements.list,this.filtered,this.selectedIdx,this.locale),w(this.elements.list)}else e.key==="Enter"?(e.preventDefault(),this.selectItem(this.selectedIdx)):e.key==="Escape"&&this.close()}handleGlobalKeyDown(e){(e.metaKey||e.ctrlKey)&&e.key.toLowerCase()==="k"&&(e.preventDefault(),this.open()),this.isOpen&&e.key==="Escape"&&this.close()}handlePanelBlur(e){setTimeout(()=>{this.elements.panel.contains(document.activeElement)||this.close()},10)}handleFocusIn(e){this.isOpen&&!this.elements.panel.contains(e.target)&&this.close()}handleItemHover(e){e!==this.selectedIdx&&(this.selectedIdx=e,u(this.elements.list,this.filtered,this.selectedIdx,this.locale))}selectItem(e){const t=this.filtered[e];if(!(!t||t._isSeparator)){if(t._isSearchSuggestion){this.enterSearchMode(t._searchType,t._searchTerms);return}t._isLoading||t._isError||(this.logger.log("Item selected:",t.name,"Ctrl/Cmd pressed:",this.ctrlKeyPressed),this.addRecentItem(t),C(t,this.ctrlKeyPressed),this.close())}}performExternalSearch(e){this.showLoadingState(),this.externalSearch.debouncedSearch(e,this.searchMode.type,(t,s)=>{if(s){this.showErrorState(s.message||"Search failed"),this.logger.error("External search error:",s);return}this.externalResults=t,this.filtered=t,this.selectedIdx=0,u(this.elements.list,this.filtered,this.selectedIdx,this.locale)})}showLoadingState(){const e=[{icon:"",name:"Loading...",subtitle:"",action:null,_isLoading:!0},{icon:"",name:"Loading...",subtitle:"",action:null,_isLoading:!0},{icon:"",name:"Loading...",subtitle:"",action:null,_isLoading:!0}];this.filtered=e,u(this.elements.list,this.filtered,-1,this.locale)}showErrorState(e){const t={icon:"‚ö†Ô∏è",name:"Search Error",subtitle:e,action:null,_isError:!0};this.filtered=[t],u(this.elements.list,this.filtered,-1,this.locale)}enterSearchMode(e,t=""){this.searchMode={type:e,query:t},this.logger.log("Entering search mode for type:",e),this.elements.search.value=t,this.addSearchModeTag(e),t?this.performExternalSearch(t):(this.filtered=[],u(this.elements.list,this.filtered,this.selectedIdx,this.locale))}exitSearchMode(){this.searchMode=null,this.externalResults=[],this.externalSearch&&this.externalSearch.cancel(),this.removeSearchModeTag();const e=this.getRecentItems();this.filtered=this.mergeItemsWithRecent(e,this.items),this.selectedIdx=0,u(this.elements.list,this.filtered,this.selectedIdx,this.locale),this.logger.log("Exited search mode")}addSearchModeTag(e){this.removeSearchModeTag();const t=document.createElement("div");t.className="cmdk-search-tag",t.id=`cmdkSearchTag-${this.id}`,t.innerHTML=`
            <span class="cmdk-search-tag-text">${e}</span>
            <button class="cmdk-search-tag-close" type="button">&times;</button>
        `,t.querySelector(".cmdk-search-tag-close").addEventListener("click",()=>{this.exitSearchMode()}),this.elements.searchContainer.insertBefore(t,this.elements.search),this.elements.search.classList.add("cmdk-search-with-tag")}removeSearchModeTag(){const e=document.getElementById(`cmdkSearchTag-${this.id}`);e&&e.remove(),this.elements.search.classList.remove("cmdk-search-with-tag")}}return window.CommandPalette=k,k}();
//# sourceMappingURL=palette.min.js.map
